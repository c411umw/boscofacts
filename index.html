<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Don Bosco Wheel</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Poppins', sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 50px;
  background: #f0f0f0;
}

.wheel-container {
  position: relative;
  width: 400px;
  height: 400px;
}

canvas#wheel {
  border-radius: 50%;
  box-shadow: 0 10px 20px rgba(0,0,0,0.3);
}

.pointer {
  position: absolute;
  top: 180px;
  left: 100%;
  transform: translateX(-50%) rotate(270deg); /* points down */
  width: 0; 
  height: 0; 
  border-left: 15px solid transparent;
  border-right: 15px solid transparent;
  border-bottom: 30px solid red;
}

#spinButton {
  margin-top: 20px;
  padding: 10px 20px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
}

#spinningText {
  margin-top: 10px;
  font-weight: 700;
  font-size: 18px;
  color: #333;
}

#factPopup {
  display: none;
  position: fixed;
  top: 40%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 10px 20px rgba(0,0,0,0.3);
  text-align: center;
  font-weight: 600;
  z-index: 1000;
}

#factPopup button {
  margin-top: 10px;
  font-weight: 700;
  padding: 5px 15px;
  cursor: pointer;
}

canvas#confettiCanvas {
  position: fixed;
  top: 0;
  left: 0;
  pointer-events: none;
  width: 100%;
  height: 100%;
  z-index: 999;
}
</style>
</head>
<body>

<h1 style="font-weight:700;">Don Bosco Facts Wheel</h1>

<div class="wheel-container">
  <div class="pointer"></div>
  <canvas id="wheel" width="400" height="400"></canvas>
</div>

<button id="spinButton">Spin</button>
<div id="spinningText"></div>

<div id="factPopup">
  <p id="factText"></p>
  <button onclick="closePopup()">Close</button>
</div>

<canvas id="confettiCanvas"></canvas>

<audio id="spinSound" src="https://www.soundjay.com/button/sounds/button-16.mp3" preload="auto" loop></audio>

<script>
// Don Bosco facts
const facts = Array.from({ length: 60 }, (_, i) => `Fact ${i+1}: Example fact about Don Bosco.`);

// Canvas setup
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const radius = canvas.width / 2;
const numSectors = facts.length;
const sectorAngle = 2 * Math.PI / numSectors;

// Draw wheel
function drawWheel() {
  for (let i = 0; i < numSectors; i++) {
    ctx.beginPath();
    ctx.moveTo(radius, radius);
    ctx.arc(radius, radius, radius, i*sectorAngle, (i+1)*sectorAngle);
    ctx.fillStyle = i % 2 === 0 ? "#ffd700" : "#ffa500";
    ctx.fill();
    ctx.stroke();

    // Text
    ctx.save();
    ctx.translate(radius, radius);
    ctx.rotate((i + 0.5) * sectorAngle);
    ctx.textAlign = "right";
    ctx.fillStyle = "#000";
    ctx.font = "bold 14px 'Poppins', sans-serif";
    ctx.fillText(`Fact ${i+1}`, radius - 10, 5);
    ctx.restore();
  }
}

drawWheel();

// Spin variables
let spinning = false;
let currentAngle = 0;

// Spin button
document.getElementById("spinButton").addEventListener("click", () => {
  if(spinning) return;
  spinning = true;
  document.getElementById("spinningText").innerText = "Spinning...";

  const spinSound = document.getElementById("spinSound");
  spinSound.currentTime = 0;
  spinSound.play().catch(() => {});

  const spins = Math.floor(Math.random()*5)+5; // full rotations
  const targetIndex = Math.floor(Math.random() * numSectors);

  // Final rotation angle (aligned to pointer)
  const finalAngle = spins*2*Math.PI + (numSectors - targetIndex) * sectorAngle - sectorAngle/2;
  const duration = 4000;
  const start = performance.now();

  function animate(time) {
    const elapsed = time - start;
    const progress = Math.min(elapsed/duration, 1);
    currentAngle = finalAngle * easeOutCubic(progress);

    ctx.setTransform(1,0,0,1,0,0);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.translate(radius, radius);
    ctx.rotate(currentAngle);
    ctx.translate(-radius, -radius);
    drawWheel();

    if(progress < 1) {
      requestAnimationFrame(animate);
    } else {
      spinning = false;
      spinSound.pause();
      document.getElementById("spinningText").innerText = "";
      showFact(targetIndex);
    }
  }

  requestAnimationFrame(animate);
});

// Easing
function easeOutCubic(t){return (--t)*t*t+1;}

// Show fact popup
function showFact(index){
  document.getElementById("factText").innerText = facts[index];
  document.getElementById("factPopup").style.display = "block";
  triggerConfetti();
}

function closePopup(){document.getElementById("factPopup").style.display="none";}

// Confetti effect
const confettiCanvas = document.getElementById("confettiCanvas");
const confettiCtx = confettiCanvas.getContext("2d");
let confettiParticles = [];

function triggerConfetti(){
  confettiParticles = [];
  for(let i=0;i<100;i++){
    confettiParticles.push({
      x: Math.random()*window.innerWidth,
      y: Math.random()*window.innerHeight,
      r: Math.random()*6+4,
      dx: (Math.random()-0.5)*4,
      dy: Math.random()*3+2,
      color: `hsl(${Math.random()*360},100%,50%)`
    });
  }
  requestAnimationFrame(drawConfetti);
}

function drawConfetti(){
  confettiCtx.clearRect(0,0,window.innerWidth,window.innerHeight);
  confettiParticles.forEach(p=>{
    confettiCtx.beginPath();
    confettiCtx.arc(p.x,p.y,p.r,0,2*Math.PI);
    confettiCtx.fillStyle = p.color;
    confettiCtx.fill();
    p.x+=p.dx; p.y+=p.dy;
  });
  confettiParticles=confettiParticles.filter(p=>p.y<window.innerHeight);
  if(confettiParticles.length>0) requestAnimationFrame(drawConfetti);
}

// Resize confetti
window.addEventListener("resize", ()=>{
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
});
confettiCanvas.width = window.innerWidth;
confettiCanvas.height = window.innerHeight;
</script>
</body>
</html>
